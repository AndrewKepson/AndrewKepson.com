---
import { getCollection } from "astro:content";
import PostLayout from "@components/layouts/post-layout/post-layout.astro";
import Post from "../_components/Post/Post.astro";
import slugger from "slugger";

// getCollection must be called within getStaticPaths to ensure scope during Astro's evaluation

export async function getStaticPaths() {
	const postsCollection = await getCollection("posts");
	return postsCollection.map((post) => ({
		params: {
			category: slugger(post?.data?.category),
			slug: post?.data?.slug,
		},
		props: {
			post: post?.data,
		},
	}));
}

const { post } = Astro.props;
---

<PostLayout
	title={post?.seo?.title}
	description={post?.seo?.description}
	canonical={post?.uri}
	ogImage={post?.seo?.ogImage}
	post={post}
/>

<script>
	document.addEventListener("DOMContentLoaded", (event) => {
		document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
			anchor.addEventListener("click", function (e) {
				e.preventDefault();

				document.querySelector(this.getAttribute("href")).scrollIntoView({
					behavior: "smooth",
				});
			});
		});
	});
</script>
